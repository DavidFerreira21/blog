{{ define "main" }}
{{- $home := site.Params.home | default dict -}}
{{- $banner := $home.banner | default "images/hero.png" -}}
{{- $pages := where site.RegularPages "Type" "in" (slice "posts") -}}
{{- $pages = $pages.ByDate.Reverse -}}

<section class="home-hero">
    <div class="hero-inner">
        <div class="hero-copy">
            {{- with $home.kicker }}
            <p class="hero-kicker">{{ . }}</p>
            {{- end }}
            <h1 class="hero-title">{{ $home.title | default site.Title }}</h1>
            {{- with $home.subtitle }}
            <p class="hero-subtitle">{{ . }}</p>
            {{- end }}

            {{- if and $home.secondaryButtonLabel $home.secondaryButtonUrl }}
            <div class="hero-actions">
                <a class="hero-btn ghost" href="{{ $home.secondaryButtonUrl | relURL }}">{{ $home.secondaryButtonLabel }}</a>
            </div>
            {{- end }}

        </div>

        <div class="hero-media">
            <img src="{{ $banner | absURL }}" alt="{{ $home.title | default site.Title }}">
        </div>
    </div>
</section>

<section class="home-feed">
    <div class="feed-header">
        <div>
            <p class="feed-kicker">{{ $home.feedKicker | default "Novidades" }}</p>
            <h2 class="feed-title">{{ $home.feedTitle | default "Ãšltimos artigos e labs" }}</h2>
        </div>
    </div>

    {{- with site.Taxonomies.categories }}
    <div class="category-select">
        <details class="category-dropdown">
            <summary>All categories</summary>
            <div class="category-options">
                <a class="category-option" href="{{ "posts/" | relURL }}">All categories</a>
                {{- range $name, $taxonomy := . }}
                <a class="category-option" href="{{ printf "posts/?cat=%s" ($name | urlize) | relURL }}">{{ $name }}</a>
                {{- end }}
            </div>
        </details>
    </div>
    {{- end }}

    <div class="feed-grid">
        {{- range first 6 $pages }}
        <article class="home-card has-media">
            <a class="card-link" href="{{ .RelPermalink }}">
                {{- $cover := "" -}}
                {{- with .Params.cover }}
                {{- $cover = .image | default "" -}}
                {{- end -}}
                {{- if not $cover }}
                {{- with .Params.image }}
                {{- $cover = . -}}
                {{- end -}}
                {{- end -}}
                {{- if $cover }}
                <div class="card-media">
                    <img src="{{ $cover | relURL }}" alt="{{ with .Params.cover }}{{ .alt | default $.Title }}{{ else }}{{ .Title }}{{ end }}" loading="lazy" decoding="async">
                </div>
                {{- end }}
                <div class="card-meta">
                    <span class="card-section">
                        {{- with .CurrentSection }}{{ .Title }}{{- else }}{{ .Section | title }}{{- end }}
                    </span>
                    <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "02 Jan 2006" }}</time>
                </div>
                <h3 class="card-title">{{ .Title }}</h3>
                {{- with .Summary }}
                <p class="card-summary">{{ . | plainify | truncate 160 }}</p>
                {{- end }}
                {{- with .Params.tags }}
                <div class="card-tags">
                    {{- range first 3 . }}
                    <span class="tag">#{{ . }}</span>
                    {{- end }}
                </div>
                {{- end }}
            </a>
        </article>
        {{- end }}
    </div>

    {{- if and $home.feedButtonLabel $home.feedButtonUrl }}
    <div class="feed-footer">
        <a class="hero-btn primary" href="{{ $home.feedButtonUrl | relURL }}">{{ $home.feedButtonLabel }}</a>
    </div>
    {{- end }}
</section>
{{ end }}
